# SQLModel –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ 

# (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è item
'''
–°–û–í–ï–¢ –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Æ: —ç—Ç–æ—Ç –±–ª–æ–∫ –±—ã–ª –≤ –∫–æ–Ω—Ü–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–Ω—è—Ç–∏—è.
–ï—Å–ª–∏ –≤—ã —É—Å–ø–µ–ª–∏ –µ–≥–æ –¥–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞–º –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∑–∞–Ω—è—Ç–∏–∏, —Ç–æ –º–æ–∂–µ—Ç–µ —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å
–∫ —Å–ª–µ–¥—É—é—â–µ–º—É –±–ª–æ–∫—É —É—Ä–æ–∫–∞. –ï—Å–ª–∏ –Ω–µ —É—Å–ø–µ–ª–∏ - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–∞–π—Ç–µ —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª —Å—Ç—É–¥–µ–Ω—Ç–∞–º,
–±–µ–∑ –Ω–µ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç—ã –Ω–µ —Å–º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–ª—å—à–µ –Ω–∞ –∑–∞–Ω—è—Ç–∏–∏.

–ü–æ—Å–ª–µ –∑–∞–Ω—è—Ç–∏—è "SQLModel –∏ –º–µ–∂—Ç–∞–±–ª–∏—á–Ω—ã–µ —Å–≤—è–∑–∏" —É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –±—ã–ª–æ –î–ó –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω–∏—è item –ø–æ 
ID. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ñ–∞–π–ª–∞—Ö app/repositories/items.py –∏ 
app/routes/items.py. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ–±—ã —É –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —É–¥–∞–ª–µ–Ω–∏–µ item –±—ã–ª–æ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö.
–†–µ—á—å –ø—Ä–æ —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏:
'''

# app/repositories/items.py

async def delete_item(session: AsyncSession, item: Item):
    await session.delete(item)
    await session.commit()

# app/routes/items.py

@router.delete('/{item_id}')
async def delete_item_by_id(item_id: UUID, session: SessionDep):
    item = await get_item(session, item_id)
    if item is None:
        raise HTTPException(status_code=404, detail='Item not found')
    await delete_item(session=session, item=item)
    return {'status': 'deleted'}

# -------------------------------------------------------------------------------------------------

# –ü—Ä–æ–±–ª–µ–º–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

'''
–í –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –º—ã –º–æ–∂–µ–º –∑–∞—Ö–æ–¥–∏—Ç—å —É–¥–∞–ª–∏—Ç—å –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å –æ–±—ä–µ–∫—Ç –∏–∑ –Ω–∞—à–µ–π –ë–î.
–í–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–µ–º–Ω–æ–≥–æ - –ª–∏–±–æ —É–¥–∞–ª–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä —Å—É—â–Ω–æ—Å—Ç–∏ Item, –ª–∏–±–æ —ç–∫–∑–µ–º–ø–ª—è—Ä —Å—É—â–Ω–æ—Å—Ç–∏ User.
–ò –µ—Å–ª–∏ —Å Item, –∫–∞–∫ –º—ã —É–∂–µ –≤–∏–¥–µ–ª–∏, –ø—Ä–æ–±–ª–µ–º –æ—Å–æ–±—ã—Ö –Ω–µ—Ç, —Ç–æ –≤–æ—Ç —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å
–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏. 

–°–û–í–ï–¢ –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Æ: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –≤ –ë–î —Å–µ–π—á–∞—Å –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,
–¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω—ã —Ö–æ—Ç—è –±—ã 2 –æ–±—ä–µ–∫—Ç–∞ item.

–ò—Ç–∞–∫, –ø–æ–ø—Ä–æ–±—É–µ–º —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –Ω–µ–º—É –æ–±—ä–µ–∫—Ç—ã.
–î–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—É—Å—Ç–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–º DELETE /users/{user_id}.
–ü–µ—Ä–µ–¥–∞–¥–∏–º —Ç—É–¥–∞ UUID –Ω–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –º—ã –ø–æ–ª—É—á–∏–º —Å—Ç–∞—Ç—É—Å 
500 Internal Server Error. –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º—ã —É–≤–∏–¥–∏–º –ø–æ–¥–æ–±–Ω—É—é –æ—à–∏–±–∫—É:
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) 
<class 'asyncpg.exceptions.NotNullViolationError'>: 
–∑–Ω–∞—á–µ–Ω–∏–µ NULL –≤ —Å—Ç–æ–ª–±—Ü–µ "user_id" –æ—Ç–Ω–æ—à–µ–Ω–∏—è "items" –Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ NOT NULL.

–ò—Ç–∞–∫, —á—Ç–æ –∂–µ —Å–ª—É—á–∏–ª–æ—Å—å? –ú—ã —Ö–æ—Ç–∏–º —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º–∏ –∫ –Ω–µ–º—É –æ–±—ä–µ–∫—Ç–∞–º–∏ (items).
–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ORM –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–≤—è–∑–∞—Ç—å –æ—Ç –Ω–µ–≥–æ items, –ø–æ—Å—Ç–∞–≤–∏–≤ –≤ –ë–î user_id = NULL.
–ù–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–∏ Item, –∞ –∑–Ω–∞—á–∏—Ç –∏ –ë–î, –∑–∞–ø—Ä–µ—â–∞–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å NULL –≤ items.user_id,
–ø–æ—ç—Ç–æ–º—É –º—ã –∏ –≤–∏–¥–∏–º —Ç–µ–∫—É—â—É—é –æ—à–∏–±–∫—É. –ù–æ –∫–∞–∫ –∂–µ —Ç–æ–≥–¥–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?
–î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Å–µ–π—á–∞—Å –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º üòâ
'''

# -------------------------------------------------------------------------------------------------

# –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

'''
–ò—Ç–∞–∫, –¥–∞–≤–∞–π—Ç–µ –µ—â–µ —Ä–∞–∑ –ø—Ä–æ–≥–æ–≤–æ—Ä–∏–º –≤—Å–µ –≤–≤–æ–¥–Ω—ã–µ –¥–ª—è –Ω–∞—à–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏:
- –£ –Ω–∞—Å –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (users) –∏ –∏—Ö –æ–±—ä–µ–∫—Ç—ã (items).
- –ü–æ–ª–µ items.user_id - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ –ø–æ–ª–µ users.id. –¢–∞–∫ –º—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º,
—á—Ç–æ –∫–∞–∂–¥—ã–π item –æ–±—è–∑–∞–Ω —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –ö–æ–≥–¥–∞ –º—ã —É–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–µ—à–∏—Ç—å, —á—Ç–æ –¥–µ–ª–∞ —Å –µ–≥–æ items.
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–∞—à –≥–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å: "–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å items –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ user?".
–†–∞—Å—Å–º–æ—Ç—Ä–∏–º 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞:

1) –†—É—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
–ó–¥–µ—Å—å –∏–¥–µ—è –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∞—è - –º—ã —Å–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º items,
–∞ —É–∂–µ –∑–∞—Ç–µ–º —É–¥–∞–ª—è–µ–º —Å–∞–º–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –° –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –∑–¥–µ—Å—å –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è
–Ω–∞–¥ –¥–µ–π—Å—Ç–≤–∏—è–º–∏, —Å –¥—Ä—É–≥–æ–π - –±–æ–ª—å—à–µ –∫–æ–≥–¥–∞ –∏ –≤—ã—à–µ —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å –æ—à–∏–±–∫—É.

2) ORM-–∫–∞—Å–∫–∞–¥
–≠—Ç–æ —É–∂–µ —á–∞—Å—Ç—å —Ä–∞–±–æ—á–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è. –ò–¥–µ—è –≤ —Ç–æ–º, —á—Ç–æ –º—ã —É–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ ORM,
–∞ –¥–∞–ª—å—à–µ —Å–∞–º –º–µ—Ö–∞–Ω–∏–∑–º ORM —É–¥–∞–ª—è–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º items. –ó–≤—É—á–∏—Ç —Ö–∞–π–ø–æ–≤–æ,
–¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π üòÅ ORM-–∫–∞—Å–∫–∞–¥ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ "–≤–ª–∞–¥–µ–ª—å—Ü–∞",
—Ç–æ –µ—Å—Ç—å —Ç–∞–º, –≥–¥–µ —É –º–æ–¥–µ–ª–∏ –Ω–µ—Ç foreign key. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ - —ç—Ç–æ –∫–ª–∞—Å—Å User –≤ —Ñ–∞–π–ª–µ
app/models/users.py. –î–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∫–∞—Å–∫–∞–¥–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–∫–∞–∂–µ–º –≤ –ø–æ–ª–µ items, –∞ —Ç–æ—á–Ω–µ–µ - 
–≤ —Ñ—É–Ω–∫—Ü–∏–∏ Relationship(), –ø–∞—Ä–∞–º–µ—Ç—Ä cascade_delete=True:
'''

# app/models/users.py

class User(UserBase, table=True):
    ...
    items: list["Item"] = Relationship(
        back_populates="user", 
        cascade_delete=True
    )

'''
–í —Ç–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è SQLModel –≤—ã–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
- –£–±–µ–¥–∏—Ç—Å—è, —á—Ç–æ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–º –æ–±—ä–µ–∫—Ç—ã items –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É.
–ï—Å–ª–∏ –æ–Ω–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, —Ç–æ SQLModel –æ—Ç–ø—Ä–∞–≤–∏—Ç SELECT-–∑–∞–ø—Ä–æ—Å –≤ –ë–î –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω—É–∂–Ω—ã—Ö items.
- –û—Ç–ø—Ä–∞–≤–∏—Ç –≤ –ë–î DELETE-–∑–∞–ø—Ä–æ—Å, –≤–∫–ª—é—á–∞—é—â–∏–π –∫–∞–∂–¥—ã–π —Å–≤—è–∑–∞–Ω–Ω—ã–π item.
- –û—Ç–ø—Ä–∞–≤–∏—Ç –≤ –ë–î DELETE-–∑–∞–ø—Ä–æ—Å –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π Python-–∫–æ–¥ –ø–æ–∑–∞–±–æ–¥–∏—Ç—Å—è –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π,
—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∏–∑ –Ω–∏—Ö.

3) –ë–î-–∫–∞—Å–∫–∞–¥
–í –ø—Ä–µ–¥—ã–¥—É—â–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ –º—ã —É–≤–∏–¥–µ–ª–∏, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ cascade_delete –ø–æ–∑–≤–æ–ª—è–µ—Ç 
–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –∫–æ–¥–∞ Python. –ù–æ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Å–∏—Ç—É–∞—Ü–∏—è, —á—Ç–æ –º—ã
–∏–ª–∏ –∫—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–π –±—É–¥–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –Ω–∞—à–µ–π –ë–î –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ Python-–∫–æ–¥–∞,
–∏ —É–¥–∞–ª–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–º–æ—â—å—é SQL-–∑–∞–ø—Ä–æ—Å–∞. –í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –º—ã –º–æ–∂–µ–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞—à—É –ë–î
–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π. –î–ª—è —ç—Ç–æ–≥–æ —É–∂–µ –≤ –º–æ–¥–µ–ª–∏ Item, –Ω–µ User,
–≤ –ø–æ–ª–µ user_id, –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ Field(), —É–∫–∞–∂–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä ondelete="CASCADE".
'''

# app/models/items.py

class Item(ItemBase, table=True):
    ...
    user_id: UUID = Field(
        foreign_key='users.id', 
        nullable=False, 
        ondelete="CASCADE"
    )

'''
–ò—Ç–∞–∫, —Ç–µ–ø–µ—Ä—å –≤ –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–∞–∫ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã ORM, —Ç–∞–∫ –∏ 
—Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ë–î. –ù–æ —á—Ç–æ–±—ã –ë–î –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–ª–∞ —É–¥–∞–ª—è—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∫–∞–∫ –º—ã —ç—Ç–æ–≥–æ —Ö–æ—Ç–∏–º,
–Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—É—é –º—ã –æ–±–Ω–æ–≤–∏–º —Ç–∏–ø –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ items.user_id.

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

alembic revision --autogenerate -m "add ondelete cascade"

–ü—Ä–∏–º–µ–Ω–∏–º —Å–æ–∑–¥–∞–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é:

alembic upgrade head

–°—É–ø–µ—Ä, –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, —Ç–µ–ø–µ—Ä—å —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ
 –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ ORM, —Ç–∞–∫ –∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ë–î!

–†–∞–Ω–µ–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä ondelete –≤ –∑–Ω–∞—á–µ–Ω–∏–µ "CASCADE", –Ω–æ –µ—Å—Ç—å –∏ –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.
–ó–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º, –∫–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å —É ondelete:
- "CASCADE" - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏.
–¢–æ –µ—Å—Ç—å –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ user –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ items.
- "SET NULL" - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ NULL –¥–ª—è –ø–æ–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ –ø—Ä–∏
—É–¥–∞–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏. –¢–æ –µ—Å—Ç—å –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ user —É –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö
items –≤ –ø–æ–ª–µ user_id –≤—ã—Å—Ç–∞–≤–∏—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ NULL.
- "RESTRICT" - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—à–∏–±–∫–∏,
–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏. –¢–æ –µ—Å—Ç—å –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
user, –µ—Å–ª–∏ –µ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º items, –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –æ—à–∏–±–∫–∞.

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ondelete.

–ò—Ç–∞–∫, –¥–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç.
–û–±—Ä–∞—Ç–∏–º—Å—è –∫ —ç–Ω–¥–ø–æ–∏–Ω–¥—É DELETE /users/{user_id} –∏ —É–∫–∞–∂–µ–º UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É –∫–æ—Ç–æ—Ä–æ–≥–æ
–µ—Å—Ç—å items –≤ –Ω–∞—à–µ–π –ë–î. –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –º—ã –ø–æ–ª—É—á–∏–º –æ—Ç–≤–µ—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 200
–∏ —Ç–µ–ª–æ–º {"status": "deleted"}. –ï—Å–ª–∏ –∑–∞–π—Ç–∏ –≤ DBeaver, –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã users –∏ items,
—Ç–æ —É–≤–∏–¥–∏–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º –æ–±—ä–µ–∫—Ç—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã üòÉ

–°–û–í–ï–¢ –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Æ: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∏–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ
—Å –Ω–∏–º items.

–ò—Ç–∞–∫, –º—ã –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ, –≥–¥–µ ondelete="CASCADE". –ù–æ –¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.
–í—ã—Å—Ç–∞–≤–∏–º –≤ –∫–ª–∞—Å—Å–µ Item(ItemBase, table=True) –¥–ª—è –ø–æ–ª—è user_id –≤ —Ñ—É–Ω–∫—Ü–∏–∏ Field() –∑–Ω–∞—á–µ–Ω–∏–µ
ondelete="SET NULL":
'''

# app/models/items.py

class Item(ItemBase, table=True):
    ...
    user_id: UUID = Field(
        foreign_key='users.id', 
        nullable=False, 
        ondelete="SET NULL"
    )

'''
–ï—Å–ª–∏ –º—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –ø–æ–ø—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Ç–æ –ø–æ–π–º–∞–µ–º –æ—à–∏–±–∫—É 
RuntimeError: ondelete="SET NULL" requires nullable=True.
–í—Å–µ –ª–æ–≥–∏—á–Ω–æ - —á—Ç–æ–±—ã –ø–æ–ª–µ –º–æ–≥–ª–æ –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ NULL, –Ω–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —ç—Ç–æ
–ø–æ–∑–≤–æ–ª—è–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏. –î–ª—è —ç—Ç–æ–≥–æ —É –ø–æ–ª—è user_id, –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ Field()
–≤–º–µ—Å—Ç–æ nullable=False –≤—ã—Å—Ç–∞–≤–∏–º nullable=True –∏ –∫ UUID –¥–æ–±–∞–≤–∏—Ç—å | None,
—á—Ç–æ–±—ã –≤ –∫–æ–¥–µ —Ç–æ–∂–µ –±—ã–ª–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–∑–º–æ–∂–Ω–æ–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ user_id.
'''

# app/models/items.py

class Item(ItemBase, table=True):
    ...
    user_id: UUID | None = Field(
        foreign_key='users.id', 
        nullable=True, 
        ondelete="SET NULL"
    )

'''
–° –∫–ª–∞—Å—Å–æ–º Item —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å. –°–º—ã—Å–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ondelete="SET NULL" –≤ —Ç–æ–º, —á—Ç–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ
—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º items –Ω–µ –±—É–¥—É—Ç —É–¥–∞–ª—è—Ç—å—Å—è –∏–∑ –ë–î. –ê –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞ User —É –Ω–∞—Å –Ω–∞–ø–∏—Å–∞–Ω–æ cascade_delete=True.
–ï—Å–ª–∏ —Ç–∞–∫ –∏ –æ—Å—Ç–∞–≤–∏—Ç—å, —Ç–æ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ORM –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ items, —á–µ–≥–æ –Ω–∞–º –Ω–µ –Ω–∞–¥–æ.
–ü–æ—ç—Ç–æ–º—É —É–¥–∞–ª–∏–º —ç—Ç–æ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã ondelete="SET NULL":
'''

# app/models/users.py

class User(UserBase, table=True):
    ...
    items: list["Item"] = Relationship(back_populates="user")

'''
–ú–æ–¥–µ–ª–∏ –≥–æ—Ç–æ–≤—ã, –∏ –Ω–∞–º —Å–Ω–æ–≤–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é, —Ç.–∫. –º—ã –æ–±–Ω–æ–≤–∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞
user_id –≤ —Ç–∞–±–ª–∏—Ü–µ items.

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

alembic revision --autogenerate -m "add ondelete set null"

–ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–ª–∞—Å—å, –ø—Ä–∏–º–µ–Ω–∏–º –µ–µ:

alembic upgrade head

–ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! –î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç.
–ü–µ—Ä–µ–¥ —ç—Ç–∏–º, –∫–æ–Ω–µ—á–Ω–æ, —Å–æ–∑–¥–∞–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–≤—è–∑–Ω—ã–µ —Å –Ω–∏–º items, –µ—Å–ª–∏ –∏—Ö —Å–µ–π—á–∞—Å –Ω–µ—Ç –≤ –ë–î.

–°–û–í–ï–¢ –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Æ: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –∏ —É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ –ë–î –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º items.

–ï—Å–ª–∏ –º—ã —É–¥–∞–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–æ –≤–∏–¥–∏–º –ø—Ä–∏–≤—ã—á–Ω—ã–π {"status": "deleted"}, 
–∞ –≤ DBeaver, –≤ —Ç–∞–±–ª–∏—Ü–µ items, —É —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Å—Ç–æ–ª–±—Ü–µ user_id –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ NULL,
–∫–∞–∫ –º—ã –∏ —Ö–æ—Ç–µ–ª–∏! –¢–æ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —É–¥–∞–ª–µ–Ω, –Ω–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º items –æ—Å—Ç–∞–ª–∏—Å—å –≤ –ë–î.
–£ –Ω–∞—Å –µ—Å—Ç—å 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—ä–µ–∫—Ç–∞–º–∏:
- —É–¥–∞–ª–∏—Ç—å –∏—Ö –∏–∑ –ë–î —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç DELETE /items/{item_id}
- –Ω–∞–∑–Ω–∞—á–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç PATCH /items/{item_id}
–ì–ª–∞–≤–Ω–æ–µ, —á—Ç–æ–±—ã –æ–±—ä–µ–∫—Ç–æ–≤, –≥–¥–µ user_id=NULL —É –Ω–∞—Å –Ω–µ –±—ã–ª–æ.

–°–û–í–ï–¢ –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Æ: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –∏ —É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ –ë–î –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å items,
–≥–¥–µ ser_id=NULL.

–ú—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ ondelete="SET NULL", –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ä–∞–±–æ—Ç—É ondelete="RESTRICT".
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —ç—Ç–æ, –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–µ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º items. –ï—Å–ª–∏ –∂–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö items –Ω–µ—Ç - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–∏—Ç—Å—è. 

–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –≤ –∫–ª–∞—Å—Å–µ Item –¥–ª—è user_id –≤—ã—Å—Ç–∞–≤–ª—è–µ–º ondelete="RESTRICT", –∞ —Ç–∞–∫–∂–µ nullable=False,
—Ç.–∫. –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ item –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –ò –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å | None –¥–ª—è UUID.
'''

# app/models/items.py

class Item(ItemBase, table=True):
    ...
    user_id: UUID = Field(
        foreign_key='users.id', 
        nullable=False, 
        ondelete="RESTRICT"
    )

'''
–° –∫–ª–∞—Å—Å–æ–º Item —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å, –∫–ª–∞—Å—Å User —É –Ω–∞—Å —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –¢–µ–ø–µ—Ä—å, –∫–∞–∫ –≤—ã —É–∂–µ –¥–æ–≥–∞–¥–∞–ª–∏—Å—å,
–Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é, —Ç.–∫. –æ–±–Ω–æ–≤–∏–ª–∏—Å—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ user_id:

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

alembic revision --autogenerate -m "add ondelete restrict"
alembic upgrade head

–ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º items.

–°–û–í–ï–¢ –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Æ: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –∏ —É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ –ë–î –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º items.

–ï—Å–ª–∏ –º—ã –ø–æ–ø—Ä–æ–±—É–µ–º —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ items, —Ç–æ —É–≤–∏–¥–∏–º –æ—à–∏–±–∫—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) 
<class 'asyncpg.exceptions.NotNullViolationError'>: 
–∑–Ω–∞—á–µ–Ω–∏–µ NULL –≤ —Å—Ç–æ–ª–±—Ü–µ "user_id" –æ—Ç–Ω–æ—à–µ–Ω–∏—è "items" –Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ NOT NULL

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ —É–¥–∞–ª–∏–ª—Å—è. –î–∞–≤–∞–π—Ç–µ —É–¥–∞–ª–∏–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
items –ø–æ –æ–¥–Ω–æ–º—É —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç DELETE /items/{item_id}, –∞ –ø–æ—Ç–æ–º –ø–æ–ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–°–û–í–ï–¢ –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Æ: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –∏ —É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —É–¥–∞–ª–µ–Ω—ã —Å–≤—è–∑–∞–Ω–Ω—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º items.

–ï—Å–ª–∏ –º—ã –ø–æ–ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É –∫–æ—Ç–æ—Ä–æ–≥–æ —É–∂–µ –Ω–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –Ω–∏–º items,
—Ç–æ —É–≤–∏–¥–∏–º {"status": "deleted"}, –∑–Ω–∞—á–∏—Ç –≤—Å–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!
'''

# -------------------------------------------------------------------------------------------------

# –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ë–î

'''
–ú—ã –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏ –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
–¢–µ–ø–µ—Ä—å –∂–µ –¥–æ–±–∞–≤–∏–º –Ω–µ–±–æ–ª—å—à—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –∫ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º üòé
–†–µ—á—å –∏–¥–µ—Ç –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ passive_deletes –≤ —Ñ—É–Ω–∫—Ü–∏–∏ Relationship()
—Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º "all". –° –ø–æ–º–æ—â—å—é —ç—Ç–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –º—ã –≥–æ–≤–æ—Ä–∏–º ORM: "–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ User –Ω–µ
—Ç—Ä–æ–≥–∞–π —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã Item (–Ω–µ –∑–∞–≥—Ä—É–∂–∞–π, –Ω–µ –æ–±–Ω–æ–≤–ª—è–π, –Ω–µ —É–¥–∞–ª—è–π). –ü—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏
User, –∞ —Å—É–¥—å–±—É –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ Item —Ä–µ—à–∏—Ç —Å–∞–º–∞ –ë–î –ø–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞".
–¢–æ –µ—Å—Ç—å –º—ã —Å–Ω–∏–º–∞–µ–º –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—å –ø–æ —É–¥–∞–ª–µ–Ω–∏—é items —Å –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –¥–æ–≤–µ—Ä—è–µ–º
—ç—Ç–æ –Ω–∞—à–µ–π –ë–î. –ë–ª–∞–≥–æ, PostgreSQL —Å —ç—Ç–∏–º –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è. –£–∫–∞–∂–µ–º —ç—Ç—É –Ω–∞—Å—Ç—Ä–æ–π–∫—É
–≤ –∫–ª–∞—Å—Å–µ User, –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ Relationship(). –ü—Ä–∏ —ç—Ç–æ–º passive_deletes="all"
–Ω–µ–ª—å–∑—è —Å–æ—á–µ—Ç–∞—Ç—å —Å cascade_delete=True, —ç—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –æ—à–∏–±–∫–µ:
'''

# app/models/users.py

class User(UserBase, table=True):
    ...
    items: list["Item"] = Relationship(
        back_populates="user", 
        passive_deletes="all"
    )

'''
–î–∞–ª–µ–µ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î. –í–µ—Ä–Ω–µ–º –∫ –≤–∞—Ä–∏–∞–Ω—Ç—É, –≥–¥–µ
–≤–º–µ—Å—Ç–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ items - ondelete="CASCADE":
'''

# app/models/items.py

class Item(ItemBase, table=True):
    ...
    user_id: UUID = Field(
        foreign_key='users.id', 
        nullable=False, 
        ondelete="CASCADE"
    )

'''
–ú–æ–¥–µ–ª–∏ –≥–æ—Ç–æ–≤—ã, —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º –∏ –ø—Ä–∏–º–µ–Ω–∏–º –º–∏–≥—Ä–∞—Ü–∏—é:

alembic revision --autogenerate -m "add passive deletes all and ondelete cascade"
alembic upgrade head

–ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –°–Ω–æ–≤–∞ —Å–æ–∑–¥–∞–¥–∏–º
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –Ω–∏–º items.

–°–û–í–ï–¢ –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Æ: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –∏ —É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ –ë–î –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º items.

–ó–∞—Ç–µ–º —É–¥–∞–ª–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç DELETE /users/{user_id}.
–ü—Ä–∏ —ç—Ç–æ –±—É–¥–µ–º –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –≥–¥–µ –æ–¥–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ª–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î.
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –º—ã —É–≤–∏–¥–∏–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –µ–≥–æ items —É–¥–∞–ª–µ–Ω—ã, 
–∞ –≤ –ª–æ–≥–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
2026-01-27 22:29:24,189 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-01-27 22:29:24,206 INFO sqlalchemy.engine.Engine SELECT users.username AS users_username, users.is_active AS users_is_active, users.id AS users_id 
FROM users
WHERE users.id = $1::UUID
2026-01-27 22:29:24,211 INFO sqlalchemy.engine.Engine [generated in 0.00517s] (UUID('9f17f8f9-0e42-4e81-b37a-46353c7c3731'),)
2026-01-27 22:29:24,229 INFO sqlalchemy.engine.Engine DELETE FROM users WHERE users.id = $1::UUID
2026-01-27 22:29:24,232 INFO sqlalchemy.engine.Engine [generated in 0.00527s] (UUID('9f17f8f9-0e42-4e81-b37a-46353c7c3731'),)
2026-01-27 22:29:24,245 INFO sqlalchemy.engine.Engine COMMIT

–í–∏–¥–Ω–æ, —á—Ç–æ ORM –Ω–µ –¥–µ–ª–∞–ª–∞ SELECT- –∏ DELETE-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∞–±–ª–∏—Ü–µ items, –∞ –≤—ã–ø–æ–ª–Ω–∏–ª–∞ —Ç–æ–ª—å–∫–æ SELECT-–∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
—Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –∑–∞—Ç–µ–º DELETE-–∑–∞–ø—Ä–æ—Å –Ω–∞ –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏–µ. –í—ã–≤–æ–¥ - —É–¥–∞–ª–µ–Ω–∏–µ–º items –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–Ω–∏–º–∞–ª–∞—Å—å
–ë–î, –∫–∞–∫ –º—ã –∏ —Ö–æ—Ç–µ–ª–∏!

–ú—ã –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏ –Ω–µ–º–∞–ª–æ –ø–æ–ª–µ–∑–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤, –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤—ã–≤–æ–¥—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤ —Ç–∞–±–ª–∏—á–∫–µ:

"–í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤"

| –¶–µ–ª—å                                                   | –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?          | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞                                                  |
| -------------------------------------------------------| ---------------------------------------------------------| -------------------------------------------------------------------------|
| –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—Å–µ –µ–≥–æ items –Ω–∞ —É—Ä–æ–≤–Ω–µ ORM     | –£–¥–∞–ª–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ items –ø–æ–ª—å–Ω–æ—Å—Ç—å—é –∑–∞–Ω–∏–º–∞—Ç–µ—Å—è ORM | cascade_delete=True + ondelete="CASCADE" –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–±–æ—Ç—ã —á–∏—Å—Ç–æ–≥–æ SQL|
| –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—Å–µ –µ–≥–æ items –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î      | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è–µ—Ç ORM, —Å–≤—è–∑–∞–Ω–Ω—ã–µ items —É–¥–∞–ª—è–µ—Ç –ë–î     | ondelete="CASCADE" + passive_deletes="all"                               |
| –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–æ items –æ—Å—Ç–∞–≤–∏—Ç—å                | –£ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö items user_id —Å—Ç–∞–Ω–µ—Ç NULL                    | ondelete="SET NULL" + nullable=True + passive_deletes="all"              |
| –ó–∞–ø—Ä–µ—Ç–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –µ—Å—Ç—å items       | –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π, –ø–æ–∫–∞ –µ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ items     | ondelete="RESTRICT" + passive_deletes="all"                              |
'''